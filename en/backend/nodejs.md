# Node.js Technology Stack

## Effective standard

This document defines the **mandatory standard** for building backend services with Node.js (TypeScript) at FIBEX.

- **Compliance**: mandatory for new services and for significant structural changes.
- **Exceptions**: require technical justification, risk assessment, and explicit approval by the architecture committee.
- **Quality (ISO/IEC 25010)**: validated via CI/CD (lint, tests, reproducible build, dependency and container security).

This document outlines the specific standards and conventions for developing backend services with Node.js and TypeScript.

## Quality Gates (mandatory)

The following controls are **merge-blocking**: if they fail, the PR cannot be merged.

Levels:

- **Standard**: internal services or moderate impact.
- **TELCO Critical**: strict SLAs, high exposure, operational/regulatory impact, or network/service criticality.

| Control | Standard tool | Standard | TELCO Critical | Blocks merge |
|---|---|---:|---:|:---:|
| Formatting | Prettier | No diffs | No diffs | Yes |
| Lint | ESLint | 0 errors | 0 errors | Yes |
| Type-check | TypeScript | `strict: true` (no errors) | `strict: true` (no errors) | Yes |
| Tests | Jest (+ Supertest for HTTP) | Coverage >= 80% overall; 100% in critical code | Coverage >= 90% overall; 100% in critical code | Yes |
| SAST (recommended baseline) | SonarQube/Semgrep (or equivalent) | 0 High findings without exception | 0 Medium/High findings without exception | Yes |
| Dependencies | `npm audit` / Snyk / Dependabot | 0 High/Critical without exception | 0 High/Critical without exception | Yes |
| Secrets | Gitleaks (or equivalent) | 0 findings | 0 findings | Yes |
| Containers (if applicable) | Trivy | 0 High/Critical without exception | 0 High/Critical without exception | Yes |

## Security & supply chain (mandatory)

- Secrets management: forbidden in repo. Use per-environment variables and a vault when applicable.
- Authentication/authorization: enforce on backend/gateway; never rely on frontend checks.
- Dependency hygiene: justify new dependencies; pin versions; keep lockfiles committed.
- Build provenance: releases must be built in CI; do not deploy artifacts produced locally.

## Core Stack
- **Language**: [TypeScript](https://www.typescriptlang.org/)
- **Frameworks**:
  - For simple services or APIs: [Express](https://expressjs.com/)
  - For complex, enterprise-level microservices: [NestJS](https://nestjs.com/)
- **Database**: [PostgreSQL](https://www.postgresql.org/)
- **ORM**: [Prisma](https://www.prisma.io/) is required for all database interactions.

## Testing
- **Unit/Integration**: [Jest](https://jestjs.io/)
- **E2E**: [Supertest](https://github.com/visionmedia/supertest)

## Naming Conventions
- **Variables and Functions**: `camelCase`.
- **Classes**: `PascalCase`.
- **Files and Directories**: `kebab-case`.

## Directory Structure (NestJS)
For NestJS projects, adhere to the standard structure generated by the Nest CLI.

## Directory Structure (Express)
A feature-based directory structure is the standard.

`src`
`├── api`
`│   ├── index.ts                 # Main router that combines feature routes`
`│   └── features`
`│       └── users`
`│           ├── user.controller.ts   # Route handlers`
`│           ├── user.service.ts      # Business logic`
`│           ├── user.repository.ts   # Database interaction`
`│           ├── user.routes.ts       # Feature-specific routes`
`│           └── user.types.ts        # Zod schemas and types`
`├── config                       # Environment variables, etc.`
`├── middleware                   # Shared middleware`
`├── lib                          # Utility functions`
`├── server.ts                    # Server setup and startup`
`└── app.ts                       # Express app setup`
